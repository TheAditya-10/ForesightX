schema: '2.0'
stages:
  data_ingestion:
    cmd: python src/data/make_dataset.py
    deps:
    - path: src/data/make_dataset.py
      hash: md5
      md5: 76b2dc77df8ea58f34d891ff6ccd65ac
      size: 21042
    - path: src/services/logger.py
      hash: md5
      md5: 3a571d672a3ea9d7531edf517f93e80d
      size: 6927
    params:
      params.yaml:
        data_ingestion.end_date: '2025-12-20'
        data_ingestion.source: yfinance
        data_ingestion.start_date: '2015-01-01'
        data_ingestion.stock_symbol: NVDA
    outs:
    - path: data/raw/stock_data_raw_NVDA.csv
      hash: md5
      md5: f4c5422a505c31a1e1d6980dedeb587b
      size: 325740
  data_preprocessing:
    cmd: python src/data/preprocess.py
    deps:
    - path: data/raw/stock_data_raw_NVDA.csv
      hash: md5
      md5: f4c5422a505c31a1e1d6980dedeb587b
      size: 325740
    - path: src/data/preprocess.py
      hash: md5
      md5: 7c5b8252a97aaaa5f622492bb43b439a
      size: 25662
    params:
      params.yaml:
        data_ingestion.stock_symbol: NVDA
        preprocessing.handle_missing: ffill
        preprocessing.outlier_method: iqr
        preprocessing.outlier_threshold: 3.0
        preprocessing.remove_outliers: false
    outs:
    - path: data/processed/test_data_NVDA.csv
      hash: md5
      md5: e43d6d0e702dc4d3f87acf0a197f3950
      size: 81149
    - path: data/processed/train_data_NVDA.csv
      hash: md5
      md5: 305c5d4a1e2fd80dbd48d5d4c1dfbc31
      size: 243565
  feature_engineering:
    cmd: python src/features/build_features.py
    deps:
    - path: data/processed/test_data_NVDA.csv
      hash: md5
      md5: e43d6d0e702dc4d3f87acf0a197f3950
      size: 81149
    - path: data/processed/train_data_NVDA.csv
      hash: md5
      md5: 305c5d4a1e2fd80dbd48d5d4c1dfbc31
      size: 243565
    - path: src/features/build_features.py
      hash: md5
      md5: d921847cdda254c20ccfd772ed4476ae
      size: 34728
    params:
      params.yaml:
        data_ingestion.stock_symbol: NVDA
        feature_engineering.atr_windows:
        - 14
        - 21
        feature_engineering.bollinger_std: 2
        feature_engineering.bollinger_window: 20
        feature_engineering.ema_windows:
        - 12
        - 26
        - 50
        feature_engineering.lag_periods:
        - 1
        - 2
        - 3
        - 5
        - 10
        feature_engineering.macd_fast: 12
        feature_engineering.macd_signal: 9
        feature_engineering.macd_slow: 26
        feature_engineering.roc_periods:
        - 5
        - 10
        - 20
        feature_engineering.rsi_windows:
        - 14
        - 21
        feature_engineering.sma_windows:
        - 5
        - 10
        - 20
        - 50
        - 200
        feature_engineering.target_return_window: 1
        feature_engineering.volatility_windows:
        - 5
        - 10
        - 20
        - 30
        feature_engineering.volume_ma_windows:
        - 5
        - 20
        - 50
        feature_engineering.vwap_window: 20
    outs:
    - path: data/features
      hash: md5
      md5: dd5daa17edb295d18a655569b875d08f.dir
      size: 3349325
      nfiles: 1
  train_model:
    cmd: python src/model/train_model.py
    deps:
    - path: data/features
      hash: md5
      md5: dd5daa17edb295d18a655569b875d08f.dir
      size: 3349325
      nfiles: 1
    - path: src/model/train_model.py
      hash: md5
      md5: 82308bfae144761a87cbae0d50a0a737
      size: 21070
    params:
      params.yaml:
        data_ingestion.stock_symbol: NVDA
        models.mlp.activation: relu
        models.mlp.early_stopping: true
        models.mlp.hidden_layer_sizes:
        - 128
        - 96
        - 32
        models.mlp.learning_rate_init: 0.002
        models.mlp.max_iter: 200
        models.mlp.solver: sgd
        training.early_stopping_patience: 10
        training.random_state: 42
        training.test_size: 0.25
        training.validation_size: 0.15
    outs:
    - path: models
      hash: md5
      md5: 4c0f3620eee749e9a394d6ac484c559e.dir
      size: 505916
      nfiles: 2
  evaluate_model:
    cmd: python src/model/evaluate_model.py
    deps:
    - path: data/features
      hash: md5
      md5: dd5daa17edb295d18a655569b875d08f.dir
      size: 3349325
      nfiles: 1
    - path: models
      hash: md5
      md5: 4c0f3620eee749e9a394d6ac484c559e.dir
      size: 505916
      nfiles: 2
    - path: src/model/evaluate_model.py
      hash: md5
      md5: 29a28c45e76c90be5a97ca0636a89a01
      size: 28377
    params:
      params.yaml:
        data_ingestion.stock_symbol: NVDA
        evaluation.metrics:
        - RMSE
        - MAE
        - MAPE
        - R2
        - Sharpe_Ratio
        - Directional_Accuracy
        - Max_Drawdown
        mlflow.enabled: true
        mlflow.experiment_name: MLP_Stock_Prediction
        training.test_size: 0.25
    outs:
    - path: results
      hash: md5
      md5: ddce4248c1ba1e46f05cf8370dfb0c95.dir
      size: 50679
      nfiles: 2
  register_model:
    cmd: python src/model/model_registry.py
    deps:
    - path: metadata
      hash: md5
      md5: f00fa1a7f442e3eef046097a17c8983f.dir
      size: 36247
      nfiles: 19
    - path: models
      hash: md5
      md5: 4c0f3620eee749e9a394d6ac484c559e.dir
      size: 505916
      nfiles: 2
    - path: src/model/model_registry.py
      hash: md5
      md5: 2180f3433b1fedd615614ede0f1215fa
      size: 24826
    params:
      params.yaml:
        data_ingestion.stock_symbol: NVDA
        mlflow.dagshub_repo: ForesightX
        mlflow.dagshub_username: TheAditya-10
        mlflow.enabled: true
        model_registry.default_stage: Staging
